{% embed '@partial/block_wrapper.twig' with { extra_classes: 'block_news-cards' } %}
  {% block content %}
    <div class="container">
      {% set post_type = 'post' %}
      <span class="d-block block-title mb-0">{{fields.title}}</span>


      {% set selections = [] %}
      {% if fields.selection_type == 'manual' %}
        {% set selections = fields.selections %}
      {% elseif fields.selection_type == 'all' %}
        {% set selections = get_posts({ post_type }) %}
      {% elseif fields.selection_type == 'related' %}
        {% set relation_taxonomy = 'tax-research-area' %}
        {% set terms = fields.manually_set_taxonomy ? fields.related_taxonomies : post.terms(relation_taxonomy)|default([])|map(t => t.slug) %}
        {% set selections = get_posts({
          post_type,
          post__not_in: [post.ID],
          tax_query: [
              {
                taxonomy: relation_taxonomy,
                field: 'slug',
                terms
              },
            ],
        }) %}
      {% endif %}

      {% include '@partial/post-repeater.twig' with { posts: selections, variant: 'card' } only %}
    </div>

  {% endblock %}
{% endembed %}
